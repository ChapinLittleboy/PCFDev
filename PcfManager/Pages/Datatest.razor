@page "/DataTest"
@using System.Dynamic
@inject NavigationManager Navigation
@inject IJSRuntime JS
@inject DataService DataService
@using PcfManager.Services;
@inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment hostingEnvironment
@inject IConfiguration configuration
@inject ExportService ExportService




<SfGrid DataSource="@GridData" AllowPaging="true" AllowSorting="true" AllowFiltering="true">
    <GridColumns>
        @if (GridData?.Any() == true)
        {
            foreach (var column in ((IDictionary<string, object>)GridData.First()).Keys)
            {
                <GridColumn Field="@column" HeaderText="@column" TextAlign="TextAlign.Left"></GridColumn>
            }
        }
    </GridColumns>
</SfGrid>

<SfButton @onclick="Trypdf"> Try PDF</SfButton> 





@code {

    private List<ExpandoObject> GridData = new();
    // private PdfService pdfService = new();


    protected override async Task OnInitializedAsync()
    {
        //GridData = await DataService.GetDynamicSLDataAsync("SELECT top 10 item, [description], u_m, abc_code, p_m_t_code, family_code FROM item_mst");
        //Console.WriteLine($"Data Count: {GridData.Count}"); // This should appear if the method completes

        GridData = await DataService.GetExpiringPCFsReportAsync();

        StateHasChanged(); // Force UI update
    }


    private async void Trypdf()
    {
        //ExportService service = new ExportService(hostingEnvironment, configuration );
        MemoryStream documentStream = ExportService.CreatePDF();
        await JS.InvokeAsync<object>(
            "saveAsFile",
            "Invoice.pdf",
            Convert.ToBase64String(documentStream.ToArray()));


    }


}


