@page "/price-increase-rpt"
@using BlazorServerDatagridApp2.Models 
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Spinner
@inject DataService DataService

<PageTitle>Price Increase Rpt</PageTitle>

<h3>Price Increase Grid</h3>

<SfGrid ID="PcfsGrid" @ref="MyGrid" DataSource="@pcfDetails" AllowSorting="true" AllowPaging="true" AllowFiltering="true"
		AllowExcelExport="true" Toolbar="@(new string[] { "ExcelExport", "ColumnChooser" })"
		AllowReordering="true" AllowResizing="true"
		ShowColumnChooser="true"
		AllowGrouping="true" Height="600px" Width="100%">

	<GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.Excel"></GridFilterSettings>
	<GridEvents OnToolbarClick="ToolbarClickHandler" TValue="PCFDetail"></GridEvents>
	<GridPageSettings PageSize="20" PageSizes="@(new string[] { "10", "20", "50", "100", "All" })"></GridPageSettings>
	<GridColumns>
		<GridColumn Field="PCFNum" HeaderText="PCF #" TextAlign="TextAlign.Center" Width="100" Type="ColumnType.Number" />
		<GridColumn Field="CustomerNumber" HeaderText="Cust #" Width="120" />
		<GridColumn Field="CustomerName" HeaderText="Cust Name" Width="200" />
		<GridColumn Field="StartDate" HeaderText="Start Date" Format="d" Type="ColumnType.Date" Width="120" />
		<GridColumn Field="EndDate" HeaderText="End Date" Format="d" Type="ColumnType.Date" Width="120" />
		<GridColumn Field="PCFStatus" HeaderText="Status" TextAlign="TextAlign.Center" Width="100" />
		<GridColumn Field="PcfType" HeaderText="Type" Width="100" />
		<GridColumn Field="BuyingGroup" HeaderText="Buying Group" Width="150" />

		<GridColumn Field="BTState" HeaderText="State" Width="80" />

		<GridColumn Field="ItemNum" HeaderText="Item #" Width="120" />
		<GridColumn Field="ItemDesc" HeaderText="Item Description" Width="200" />
		<GridColumn Field="ItemStatus" HeaderText="Item Status" Width="120" />
		<GridColumn Field="PrivateLabelFlag" HeaderText="Private Label" Width="120" />
		<GridColumn Field="Family_Code" HeaderText="Family Code" Width="60" />
		<GridColumn Field="Family_Code_Description" HeaderText="Family Code Name" Width="60" />


		<GridColumn Field="ApprovedPrice" HeaderText="Approved Price" Width="120" />
	</GridColumns>
</SfGrid>

@if (isLoading)
{
	<div style="width:100%;text-align:center">
		<SfSpinner Visible="true" Size="50"></SfSpinner>
	</div>
}

@code {
	private List<PCFDetail> pcfDetails = new();
	private bool isLoading = true;
	private SfGrid<PCFDetail> MyGrid;

	protected override async Task OnInitializedAsync()
	{
		pcfDetails = await DataService.GetAllPCFDetailsAsync();
		isLoading = false;
	}

	private string GetPrivateLabelDisplay(object data, string columnName)
	{
		var item = data as PCFDetail;
		return item?.PrivateLabelFlag == 1 ? "Yes" : "No";
	}

	public async Task ToolbarClickHandler(Syncfusion.Blazor.Navigations.ClickEventArgs args)
	{
		if (args.Item.Id == "PcfsGrid_excelexport") //Id is combination of Grid's ID and itemname
		{
			var ExcelFileName = $"PriceIncreases.xlsx";
			ExcelExportProperties exportProperties = new ExcelExportProperties
				{
					FileName = ExcelFileName
				};
			await this.MyGrid.ExportToExcelAsync(exportProperties);
		}
	}
}